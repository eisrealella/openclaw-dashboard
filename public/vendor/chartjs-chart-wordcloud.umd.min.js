!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("chart.js"),require("chart.js/helpers")):"function"==typeof define&&define.amd?define(["exports","chart.js","chart.js/helpers"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ChartWordCloud={},t.Chart,t.Chart.helpers)}(this,function(t,e,n){"use strict";function r(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function o(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if("function"==typeof e){var n=function t(){var n=!1;try{n=this instanceof t}catch{}return n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(e){var r=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,r.get?r:{enumerable:!0,get:function(){return t[e]}})}),n}var a={value:function(){}};function i(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new s(r)}function s(t){this._=t}function l(t,e){for(var n,r=0,o=t.length;r<o;++r)if((n=t[r]).name===e)return n.value}function u(t,e,n){for(var r=0,o=t.length;r<o;++r)if(t[r].name===e){t[r]=a,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}s.prototype=i.prototype={constructor:s,on:function(t,e){var n,r,o=this._,a=(r=o,(t+"").trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})),i=-1,s=a.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++i<s;)if(n=(t=a[i]).type)o[n]=u(o[n],t.name,e);else if(null==e)for(n in o)o[n]=u(o[n],t.name,null);return this}for(;++i<s;)if((n=(t=a[i]).type)&&(n=l(o[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new s(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,o=new Array(n),a=0;a<n;++a)o[a]=arguments[a+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=0,n=(r=this._[t]).length;a<n;++a)r[a].value.apply(e,o)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],o=0,a=r.length;o<a;++o)r[o].value.apply(e,n)}};var c,h,f=o(Object.freeze({__proto__:null,dispatch:i}));var d=function(){if(h)return c;h=1;const t=f.dispatch,e=Math.PI/180,n={archimedean:g,rectangular:function(t){var e=4*t[0]/t[1],n=0,r=0;return function(t){var o=t<0?-1:1;switch(Math.sqrt(1+4*o*t)-o&3){case 0:n+=e;break;case 1:r+=4;break;case 2:n-=e;break;default:r-=4}return[n,r]}}},r=2048;function o(t){return t.text}function a(){return"serif"}function i(){return"normal"}function s(t){return Math.sqrt(t.value)}function l(){return 30*(~~(6*random())-3)}function u(){return 1}function d(t,n,o,a){if(!n.sprite){var i=t.context,s=t.ratio;i.clearRect(0,0,2048/s,r/s);var l=0,u=0,c=0,h=o.length;for(--a;++a<h;){n=o[a],i.save(),i.font=n.style+" "+n.weight+" "+~~((n.size+1)/s)+"px "+n.font;const t=i.measureText(n.text),h=-Math.floor(t.width/2);let m=(t.width+1)*s,v=n.size<<1;if(n.rotate){var f=Math.sin(n.rotate*e),d=Math.cos(n.rotate*e),y=m*d,p=m*f,x=v*d,g=v*f;m=Math.max(Math.abs(y+g),Math.abs(y-g))+31>>5<<5,v=~~Math.max(Math.abs(p+x),Math.abs(p-x))}else m=m+31>>5<<5;if(v>c&&(c=v),l+m>=2048&&(l=0,u+=c,c=0),u+v>=r)break;i.translate((l+(m>>1))/s,(u+(v>>1))/s),n.rotate&&i.rotate(n.rotate*e),i.fillText(n.text,h,0),n.padding&&(i.lineWidth=2*n.padding,i.strokeText(n.text,h,0)),i.restore(),n.width=m,n.height=v,n.xoff=l,n.yoff=u,n.x1=m>>1,n.y1=v>>1,n.x0=-n.x1,n.y0=-n.y1,n.hasText=!0,l+=m}for(var m=i.getImageData(0,0,2048/s,r/s).data,v=[];--a>=0;)if((n=o[a]).hasText){for(var w=n.width,b=w>>5,M=n.y1-n.y0,S=0;S<M*b;S++)v[S]=0;if(null==(l=n.xoff))return;u=n.yoff;for(var E=0,_=-1,k=0;k<M;k++){for(S=0;S<w;S++){var R=b*k+(S>>5),C=m[2048*(u+k)+(l+S)<<2]?1<<31-S%32:0;v[R]|=C,E|=C}E?_=k:(n.y0++,M--,k--,u++)}n.y1=n.y0+_,n.sprite=v.slice(0,(n.y1-n.y0)*b)}}}function y(t,e,n){n>>=5;for(var r,o=t.sprite,a=t.width>>5,i=t.x-(a<<4),s=127&i,l=32-s,u=t.y1-t.y0,c=(t.y+t.y0)*n+(i>>5),h=0;h<u;h++){r=0;for(var f=0;f<=a;f++)if((r<<l|(f<a?(r=o[h*a+f])>>>s:0))&e[c+f])return!0;c+=n}return!1}function p(t,e){var n=t[0],r=t[1];e.x+e.x0<n.x&&(n.x=e.x+e.x0),e.y+e.y0<n.y&&(n.y=e.y+e.y0),e.x+e.x1>r.x&&(r.x=e.x+e.x1),e.y+e.y1>r.y&&(r.y=e.y+e.y1)}function x(t,e){return t.x+t.x1>e[0].x&&t.x+t.x0<e[1].x&&t.y+t.y1>e[0].y&&t.y+t.y0<e[1].y}function g(t){var e=t[0]/t[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function m(){return document.createElement("canvas")}function v(t){return"function"==typeof t?t:function(){return t}}return c=function(){var e=[256,256],c=o,h=a,f=s,w=i,b=i,M=l,S=u,E=g,_=[],k=1/0,R=t("word","end"),C=null,P=Math.random,O={},z=m;function T(t,n,r){e[0],e[1];for(var o,a,i,s=n.x,l=n.y,u=Math.sqrt(e[0]*e[0]+e[1]*e[1]),c=E(e),h=P()<.5?1:-1,f=-h;(o=c(f+=h))&&(a=~~o[0],i=~~o[1],!(Math.min(Math.abs(a),Math.abs(i))>=u));)if(n.x=s+a,n.y=l+i,!(n.x+n.x0<0||n.y+n.y0<0||n.x+n.x1>e[0]||n.y+n.y1>e[1])&&(!r||x(n,r))&&!y(n,t,e[0])){for(var d,p=n.sprite,g=n.width>>5,m=e[0]>>5,v=n.x-(g<<4),w=127&v,b=32-w,M=n.y1-n.y0,S=(n.y+n.y0)*m+(v>>5),_=0;_<M;_++){d=0;for(var k=0;k<=g;k++)t[S+k]|=d<<b|(k<g?(d=p[_*g+k])>>>w:0);S+=m}return!0}return!1}return O.canvas=function(t){return arguments.length?(z=v(t),O):z},O.start=function(){var t=function(t){const e=t.getContext("2d",{willReadFrequently:!0});t.width=t.height=1;const n=Math.sqrt(e.getImageData(0,0,1,1).data.length>>2);return t.width=2048/n,t.height=r/n,e.fillStyle=e.strokeStyle="red",{context:e,ratio:n}}(z()),n=function(t){var e=[],n=-1;for(;++n<t;)e[n]=0;return e}((e[0]>>5)*e[1]),o=null,a=_.length,i=-1,s=[],l=_.map(function(t,e){return t.text=c.call(this,t,e),t.font=h.call(this,t,e),t.style=w.call(this,t,e),t.weight=b.call(this,t,e),t.rotate=M.call(this,t,e),t.size=~~f.call(this,t,e),t.padding=S.call(this,t,e),t}).sort(function(t,e){return e.size-t.size});return C&&clearInterval(C),C=setInterval(u,0),u(),O;function u(){for(var r=Date.now();Date.now()-r<k&&++i<a&&C;){var u=l[i];u.x=e[0]*(P()+.5)>>1,u.y=e[1]*(P()+.5)>>1,d(t,u,l,i),u.hasText&&T(n,u,o)&&(s.push(u),R.call("word",O,u),o?p(o,u):o=[{x:u.x+u.x0,y:u.y+u.y0},{x:u.x+u.x1,y:u.y+u.y1}],u.x-=e[0]>>1,u.y-=e[1]>>1)}i>=a&&(O.stop(),R.call("end",O,s,o))}},O.stop=function(){C&&(clearInterval(C),C=null);for(const t of _)delete t.sprite;return O},O.timeInterval=function(t){return arguments.length?(k=null==t?1/0:t,O):k},O.words=function(t){return arguments.length?(_=t,O):_},O.size=function(t){return arguments.length?(e=[+t[0],+t[1]],O):e},O.font=function(t){return arguments.length?(h=v(t),O):h},O.fontStyle=function(t){return arguments.length?(w=v(t),O):w},O.fontWeight=function(t){return arguments.length?(b=v(t),O):b},O.rotate=function(t){return arguments.length?(M=v(t),O):M},O.text=function(t){return arguments.length?(c=v(t),O):c},O.spiral=function(t){return arguments.length?(E=n[t]||t,O):E},O.fontSize=function(t){return arguments.length?(f=v(t),O):f},O.padding=function(t){return arguments.length?(S=v(t),O):S},O.random=function(t){return arguments.length?(P=t,O):P},O.on=function(){var t=R.on.apply(R,arguments);return t===R?O:t},O},c}(),y=r(d);class p extends e.Element{static computeRotation(t,e){if(t.rotationSteps<=1)return 0;if(t.minRotation===t.maxRotation)return t.minRotation;const n=Math.min(t.rotationSteps,Math.floor(e()*t.rotationSteps))/(t.rotationSteps-1),r=t.maxRotation-t.minRotation;return t.minRotation+n*r}inRange(t,e){const n=this.getProps(["x","y","width","height","scale"]);if(n.scale<=0)return!1;const r=Number.isNaN(t)?n.x:t,o=Number.isNaN(e)?n.y:e;return r>=n.x-n.width/2&&r<=n.x+n.width/2&&o>=n.y-n.height/2&&o<=n.y+n.height/2}inXRange(t){return this.inRange(t,Number.NaN)}inYRange(t){return this.inRange(Number.NaN,t)}getCenterPoint(){return this.getProps(["x","y"])}tooltipPosition(){return this.getCenterPoint()}draw(t){const{options:e}=this,r=this.getProps(["x","y","width","height","text","scale"]);if(r.scale<=0)return;t.save();const o=n.toFont({...e,size:e.size*r.scale});t.font=o.string,t.fillStyle=e.color,t.textAlign="center",t.translate(r.x,r.y),t.rotate(e.rotate/180*Math.PI),e.strokeStyle&&(null!=e.strokeWidth&&(t.lineWidth=e.strokeWidth),t.strokeStyle=e.strokeStyle,t.strokeText(r.text,0,0)),t.fillText(r.text,0,0),t.restore()}}p.id="word",p.defaults={minRotation:-90,maxRotation:0,rotationSteps:2,padding:1,strokeStyle:void 0,strokeWidth:void 0,size:t=>t.parsed.y,hoverColor:"#ababab"},p.defaultRoutes={color:"color",family:"font.family",style:"font.style",weight:"font.weight",lineHeight:"font.lineHeight"};class x extends e.DatasetController{constructor(){super(...arguments),this.wordLayout=y().text(t=>t.text).padding(t=>t.options.padding).rotate(t=>t.options.rotate).font(t=>t.options.family).fontSize(t=>t.options.size).fontStyle(t=>t.options.style).fontWeight(t=>{var e;return null!==(e=t.options.weight)&&void 0!==e?e:1}),this.rand=Math.random}update(t){var e;super.update(t);const n=this.options;this.rand=function(t=Date.now()){let e="number"==typeof t?t:Array.from(t).reduce((t,e)=>t+e.charCodeAt(0),0);return()=>(e=(9301*e+49297)%233280,e/233280)}(null!==(e=n.randomRotationSeed)&&void 0!==e?e:this.chart.id);const r=this._cachedMeta.data||[];this.updateElements(r,0,r.length,t)}updateElements(t,e,r,o){var a,i,s,l,u;this.wordLayout.stop();const c=this.options,h=this._cachedMeta.xScale,f=this._cachedMeta.yScale,d=h.right-h.left,y=f.bottom-f.top,x=this.chart.data.labels,g={maxTries:3,scalingFactor:1.2};Object.assign(g,null!==(a=null==c?void 0:c.autoGrow)&&void 0!==a?a:{});const m=[];for(let t=e;t<e+r;t+=1){const e=this.resolveDataElementOptions(t,o);null==e.rotate&&(e.rotate=p.computeRotation(e,this.rand));const r={options:{...n.toFont(e),...e},x:null!==(s=null===(i=this._cachedMeta.xScale)||void 0===i?void 0:i.getPixelForDecimal(.5))&&void 0!==s?s:0,y:null!==(u=null===(l=this._cachedMeta.yScale)||void 0===l?void 0:l.getPixelForDecimal(.5))&&void 0!==u?u:0,width:10,height:10,scale:1,index:t,text:x[t]};m.push(r)}if("reset"===o)return void m.forEach(e=>{this.updateElement(t[e.index],e.index,e,o)});this.wordLayout.random(this.rand).words(m);const v=(e=1,n=g.maxTries)=>{this.wordLayout.size([d*e,y*e]).on("end",(r,a)=>{if(r.length<x.length){if(n>0){const t="function"==typeof g.scalingFactor?g.scalingFactor(e,r,x.length):e*g.scalingFactor;return void v(t,n-1)}console.warn(`cannot fit all text elements in ${g.maxTries} tries`)}const i=a[1].x-a[0].x,s=a[1].y-a[0].y,l=c.fit?Math.min(d/i,y/s):1,u=new Set(x.map((t,e)=>e));r.forEach(e=>{u.delete(e.index),this.updateElement(t[e.index],e.index,{options:e.options,scale:l,x:h.left+l*e.x+d/2,y:f.top+l*e.y+y/2,width:l*e.width,height:l*e.height,text:e.text},o)}),u.forEach(e=>this.updateElement(t[e],e,{scale:0},o))}).start()};v()}draw(){const t=this._cachedMeta.data,{ctx:e}=this.chart;t.forEach(t=>t.draw(e))}getLabelAndValue(t){const e=super.getLabelAndValue(t),n=this.chart.data.labels;return e.label=n[t],e}}x.id="wordCloud",x.defaults={datasets:{animation:{colors:{properties:["color","strokeStyle"]},numbers:{properties:["x","y","size","rotate"]}}},maintainAspectRatio:!1,dataElementType:p.id},x.overrides={scales:{x:{type:"linear",min:-1,max:1,display:!1},y:{type:"linear",min:-1,max:1,display:!1}}};class g extends e.Chart{constructor(t,n){super(t,function(t,n,r,o=[],a=[]){e.registry.addControllers(r),Array.isArray(o)?e.registry.addElements(...o):e.registry.addElements(o),Array.isArray(a)?e.registry.addScales(...a):e.registry.addScales(a);const i=n;return i.type=t,i}("wordCloud",n,x,p))}}g.id=x.id,e.registry.addControllers(x),e.registry.addElements(p),t.WordCloudChart=g,t.WordCloudController=x,t.WordElement=p});
//# sourceMappingURL=index.umd.min.js.map
